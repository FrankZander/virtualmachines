 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" >
	<head id='head'>
		<meta http-equiv="Content-Type" content="text/html" />
		<title id='pageTitle'>Request FME Virtual Machine</title>


		<script src="libs/jquery-1.10.1.js"></script>
		<script src="http://api.fmeserver.com/js/v1.1/FMEServer.js" type="text/javascript"></script>

		<script src="js/runCreateEC2.js?ver=5" type="text/javascript"></script>
		
		  <!-- Bootstrap -->
  		<script src="libs/bootstrap/js/bootstrap.js"></script>
 		<link href="libs/bootstrap/css/bootstrap.css" rel="stylesheet" media="screen">
  		<meta name="viewport" content="width=device-width, initial-scale=1.0">
  		<link href="libs/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">	
		
		<LINK REL="STYLESHEET" TYPE="text/css" HREF="css/reset.css">
		<LINK REL="STYLESHEET" TYPE="text/css" HREF="css/ie.css">
		<LINK REL="STYLESHEET" TYPE="text/css" HREF="css/index.css">	

	

	</head>
<body>	

	  
	  
	<span id="safe-ribbon"><a href="http://www.safe.com">Powered by FME</a></span>
	  <div class="navbar navbar-fixed-top">
	    <div class="navbar-inner">
	      <div class="container">        
	        <div class="brand">Request FME Virtual Machine</div> 
	        <ul class="nav pull-left">
	        </ul>
	      </div>
	    </div>
	  </div>

		<div id="mapwrapper">
			<div id="map_canvas"></div>

		<form id="example-form">
		<input id="repository-name" type="hidden" value="FMETraining" name="repository" />
		<input id="workspace-name" type="hidden" value="PythonVMCreator.fmw" name="workspace" />
	</form>

	<script type="text/javascript">
		var repository, workspace, form;

		window.onload = function() {
			repository = document.getElementById( "repository-name" ).value;
			workspace = document.getElementById( "workspace-name" ).value;
			form = document.getElementById( "example-form" );

			FMEServer.init({
				server : "https://bluesky-safe-software.fmecloud.com",
				token : "0da8284a549462da314f97b336723e23178655d5"
			});

			// Get the workspace parameters from FME Server
			FMEServer.getWorkspaceParameters( repository, workspace, populateForm );
		};

		function populateForm( json ) {
			// Use the API to build the form items
			FMEServer.generateFormItems( "example-form", json );

			// Add the custom submit button
			var button = document.createElement( "input" );
			button.type = "button";
			button.value = "Request Virtual Machine";
			button.setAttribute( "onclick", "submitJob();" );
			form.appendChild( button );
		}

		function showResults( json ) {
			// The following is to write out the full return object
			// for visualization of the example
			var hr = document.createElement( "hr" );
			var div = document.createElement( "div" );
			div.innerHTML = "<h4>Return Object:</h4><pre>"+JSON.stringify(json, undefined, 4)+"</pre>";
			document.body.appendChild( hr );
			document.body.appendChild( div );
		}

		function submitJob() {
			// Create the the publishedParameters array, and a checkboxes object
			var params = { "publishedParameters" : [] };
			var publishedParameters = params.publishedParameters;
			var checkboxes = {};

			// Loop through the form elements and build the publishedParameters array
			for( var i = 0; i < form.elements.length; i++ ){
				var element = form.elements[i];
				var obj = { "name" : "", "value" : null }
				obj.name = element.name;
				if( element.type == "select" ) {
					obj.value = element[element.selectedIndex].value;
					publishedParameters.push( obj );
				} else if( element.type == "checkbox" ){
					if( element.checked ) {
						if( !checkboxes[element.name] ){
							checkboxes[element.name] = [];
						}
						checkboxes[element.name].push( element.value );
					}
				} else if( element.type != "hidden" && element.type != "button" ) {
					obj.value = element.value;
					publishedParameters.push( obj );
				}
			}

			// Add all grouped checkbox elements to the published parameters
			for( name in checkboxes ) {
				publishedParameters.push( { "name" : name, "value" : checkboxes[name] } );
			}

			// Submit Job to FME Server and run synchronously
			FMEServer.submitSyncJob( repository, workspace, params, showResults );
		}

	</script>
		<div id="footer">
            <!-- Do we need anything here?-->
		</div>
	</body>
</html>
